<!DOCTYPE html>
<html>
    <head>
        <title>BIG PROJECT</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <style>
            body{
              font-family: 'Source Sans 3';
              background-color: #5ea9ff;
              color: white;

              overflow: hidden;
            }
            #mapimg
            {
              color: white;
              filter: invert();
            }

            .pan-container{
              left: 160px;
              width: 100%;

              height: 100vw;

              overflow: hidden;
            }

            .main{
              position: relative;
            }
              /* def not copied from https://www.w3schools.com/howto/howto_css_fixed_sidebar.asp*/
               /* The sidebar menu */
            .sidenav {
                height: 100%; /* Full-height: remove this if you want "auto" height */
                width: 160px; /* Set the width of the sidebar */
                position: fixed; /* Fixed Sidebar (stay in place on scroll) */
                z-index: 1; /* Stay on top */
                top: 0; /* Stay at the top */
                left: 0;
                background-color: #f1f1f1; /* Black */
                overflow-x: hidden; /* Disable horizontal scroll */
                padding-top: 20px;
              }

             /* The navigation menu links */
              .sidenav a {
                padding: 6px 8px 6px 16px;
                text-decoration: none;
                font-size: 25px;
                color: #515151;
                display: block;
              }

             /* When you mouse over the navigation links, change their color */
              .sidenav a:hover {
                color: #717171;
              }

             /* Style page content */
              .main {
                margin-left: 160px; /* Same as the width of the sidebar */
                padding: 0px 10px;
              }

             /* On smaller screens, where height is less than 450px, change the style of the sidebar (less padding and a smaller font size) */
              @media screen and (max-height: 450px) {
                .sidenav {padding-top: 15px;}
                .sidenav a {font-size: 18px;}
              } 
        </style>
    </head>
    <body>
        <div class="sidenav">
            <a href="#">Map</a>
            <a href="#">GPS</a>
            <a href="#">Options</a>
            <a href="#">Account</a>
        </div>
          
          <!-- Page content -->
            <canvas id="map" style="margin-left: 160px;"></canvas>
    </body>
    <script>
      

    </script>
    <script>
      var c;

      c = document.getElementById('map');

      const ctx = c.getContext('2d');

      const offscreenCanvas = document.createElement('canvas');
      const offscreenCtx = offscreenCanvas.getContext('2d');

      const img = new Image();
img.onload = () => {
  // Set the size of the offscreen canvas to match the image

  offscreenCanvas.width = img.width*2;
  offscreenCanvas.height = img.height*2;

  // Draw the image on the offscreen canvas
  offscreenCtx.drawImage(img, 0, 0, img.width*2, img.height*2);

  ctx.imageSmoothingEnabled = true; // Enable high-quality smoothing
  ctx.imageSmoothingQuality = 'high'; // Can be 'low', 'medium', or 'high'
  // Initially draw on the main canvas
  draw();
};
img.src = 'world.svg'; // Adjust the path as needed

      const viewportTransform = {
        x: 0,
        y: 0,
        scale: 1
      }
        // We need to keep track of our previous mouse position for later
let previousX = 0, previousY = 0;

const updatePanning = (e) => {
  const localX = e.clientX;
  const localY = e.clientY;

  viewportTransform.x += localX - previousX;
  viewportTransform.y += localY - previousY;

  previousX = localX;
  previousY = localY;
}

const updateZooming = (e) => {
  const oldScale = viewportTransform.scale;
  const oldX = viewportTransform.x;
  const oldY = viewportTransform.y;

  const localX = e.clientX;
  const localY = e.clientY;

  const previousScale = viewportTransform.scale;

  const newScale = viewportTransform.scale += e.deltaY * -0.01;

  const newX = localX - (localX - oldX) * (newScale / previousScale);
  const newY = localY - (localY - oldY) * (newScale / previousScale);

  viewportTransform.x = newX;
  viewportTransform.y = newY;
  viewportTransform.scale = newScale;
}

const onMouseMove = (e) => {
  draw()
  updatePanning(e)
}

c.addEventListener("mousedown", (e) => {
  previousX = e.clientX;
  previousY = e.clientY;

  c.addEventListener("mousemove", onMouseMove);
})

c.addEventListener("mouseup", (e) => {
  c.removeEventListener("mousemove", onMouseMove);
})

const onMouseWheel = (e) => {
  updateZooming(e)

  draw()
}

c.addEventListener("wheel", onMouseWheel);
    // Create an Image object


      function draw() {
        ctx.clearRect(0, 0, c.width, c.height); // Clear the main canvas

        ctx.setTransform(1, 0, 0, 1, 0, 0);
  //ctx.setTransform(viewportTransform.scale, 0, 0, viewportTransform.scale, viewportTransform.x, viewportTransform.y);
  ctx.setTransform(viewportTransform.scale, 0, 0, viewportTransform.scale, viewportTransform.x, viewportTransform.y);
        ctx.drawImage(
          offscreenCanvas,
         0,0, c.width*4, c.height*4,
          0, 0, c.width, c.height
      );
  
      }

      window.onload = window.onresize = function() {
      
        c.width = window.innerWidth-160;
        c.height = window.innerHeight;

        draw()
    }

    </script>
</html>